<page-header></page-header>
<div fxLayout="row wrap">
  <div fxFlex="100" fxFlex.lt-sm="100">
    <mat-accordion>
      <mat-expansion-panel [expanded]="true">

        <!-- Điều kiện tìm kiếm -->
        <mat-expansion-panel-header>
          <mat-panel-title>
            {{ 'common.title' | translate | uppercase}}
          </mat-panel-title>
        </mat-expansion-panel-header>

        <!-- Form tìm kiếm -->
        <form class="form-field-full" [formGroup]="formSearch">

          <!--Row 1-->
          <div fxLayout="row wrap" fxLayoutGap="20px grid">
            <div fxFlex="33.33" fxFlex.lt-sm="100">
              <mat-form-field appearance="outline">
                <mat-label>{{ 'cateConfig.ticketType.ticketGroup' | translate }}
                </mat-label>
                <mat-select formControlName="ticketGroup" multiple>
                  <mat-select-trigger>
                    {{ getLabelInList(formSearch.controls.ticketGroup.value) }}
                  </mat-select-trigger>
                  <mat-option *ngIf="lstTicketGroup.length > 0">
                    <ngx-mat-select-search
                      noEntriesFoundLabel="{{'cateConfig.ticketType.noItemTicketGroup' | translate}}"
                      formControlName="ticketGroupFilter"
                      placeholderLabel="{{'cateConfig.ticketType.searchTicketGroup' | translate}}"
                      [showToggleAllCheckbox]="true" [toggleAllCheckboxChecked]="searchGroupAll"
                      (toggleAll)="selectAllTicketGroup($event)">
                    </ngx-mat-select-search>
                  </mat-option>
                  <mat-option *ngFor="let item of filteredTicketGroup| async" [value]="item"
                              (click)="onChangeTicketGroup()">
                    {{ item.label }}
                  </mat-option>
                </mat-select>
                <button *ngIf="formSearch.controls.ticketGroup.value" matSuffix mat-icon-button type="button"
                        class="btn-clear-drop"
                        (click)="formSearch.controls.ticketGroup.setValue(null); $event.stopPropagation(); clearTicketGroup();clearGroup();">
                  <mat-icon>close</mat-icon>
                </button>
              </mat-form-field>
            </div>

            <!--Thể loại phản ánh-->
            <div fxFlex="33.33" fxFlex.lt-sm="100">
              <mat-form-field appearance="outline">
                <mat-label>{{ 'cateConfig.ticketType.ticketGenre' | translate }}
                </mat-label>
                <mat-select formControlName="ticketGenre" multiple>
                  <mat-select-trigger>
                    {{ getLabelInList(formSearch.controls.ticketGenre.value) }}
                  </mat-select-trigger>
                  <mat-option *ngIf="lstTicketGenre.length>0">
                    <ngx-mat-select-search
                      noEntriesFoundLabel="{{'cateConfig.ticketType.noItemTicketGenre' | translate}}"
                      formControlName="ticketGenreFilter"
                      placeholderLabel="{{'cateConfig.ticketType.searchTicketGenre' | translate}}"
                      [showToggleAllCheckbox]="true" [toggleAllCheckboxChecked]="searchGenreAll"
                      (toggleAll)="selectAllTicketGenre($event)">
                    </ngx-mat-select-search>
                  </mat-option>
                  <mat-option *ngFor="let item of filteredTicketGenre | async" [value]="item"
                              (click)="onChangeTicketGenre()">
                    {{ item.label }}
                  </mat-option>
                </mat-select>
                <button *ngIf="formSearch.controls.ticketGenre.value" matSuffix mat-icon-button type="button"
                        class="btn-clear-drop"
                        (click)="formSearch.controls.ticketGenre.setValue(null); $event.stopPropagation();clearGenre();">
                  <mat-icon>close</mat-icon>
                </button>
              </mat-form-field>
            </div>

            <!-- Người  tạo -->
            <div fxFlex="33.33" fxFlex.lt-sm="100">
              <mat-form-field appearance="outline">
                <mat-label>{{ 'ticket-error-cause.ticketErrorUser' | translate }}</mat-label>
                <input matInput formControlName="createUser" autocomplete="off" />
                <button mat-button *ngIf="formSearch.controls.createUser.value" matSuffix mat-icon-button
                        aria-label="Clear" type="button"
                        (click)="formSearch.controls.createUser.setValue(null); $event.stopPropagation()"
                        class="showclear">
                  <mat-icon>close</mat-icon>
                </button>
              </mat-form-field>
            </div>
          </div>

          <!-- Row 2 -->
          <div fxLayout="row wrap" fxLayoutGap="20px grid">

            <!--Nguyên nhân lỗi cấp 1-->
            <div fxFlex="33.33" fxFlex.lt-sm="100">
              <mat-form-field appearance="outline">
                <mat-label>{{ 'ticket-error-cause.ticketErrorCauseNameLv1' | translate }}
                </mat-label>
                <mat-select formControlName="ticketErrorCauseNameLv1" multiple>
                  <mat-select-trigger>
                    {{ getLabelInList(formSearch.controls.ticketErrorCauseNameLv1.value) }}
                  </mat-select-trigger>
                  <mat-option *ngIf="lstTicketErrorCauseLv1.length > 0">
                    <ngx-mat-select-search noEntriesFoundLabel="{{'ticketExpire.search.noItemError' | translate}}"
                                           formControlName="ticketErrorCauseLv1Filter"
                                           placeholderLabel="{{'ticketExpire.search.placehoderExpireLv1' | translate}}"
                                           [showToggleAllCheckbox]="true" [toggleAllCheckboxChecked]="searchNNC1All"
                                           (toggleAll)="selectAll($event)">
                    </ngx-mat-select-search>

                  </mat-option>
                  <mat-option *ngFor="let item of filteredTicketErrorCauseLv1 | async" [value]="item"
                              (click)="onChangeTicketErrorCauseLv1()">
                    {{ item.label }}
                  </mat-option>
                </mat-select>
                <button *ngIf="formSearch.controls.ticketErrorCauseNameLv1.value" matSuffix mat-icon-button
                        type="button" class="btn-clear-drop"
                        (click)="formSearch.controls.ticketErrorCauseNameLv1.setValue(null); $event.stopPropagation(); clearTicketErrorCause1();clearCheckAll1()">
                  <mat-icon>close</mat-icon>
                </button>
              </mat-form-field>
            </div>

            <!-- Nguyên nhân lỗi cấp 2 -->
            <div fxFlex="33.33" fxFlex.lt-sm="100">
              <mat-form-field appearance="outline">
                <mat-label>{{ 'ticket-error-cause.ticketErrorCauseNameLv2' | translate }}
                </mat-label>
                <mat-select formControlName="ticketErrorCauseNameLv2" multiple>
                  <mat-select-trigger>
                    {{ getLabelInList(formSearch.controls.ticketErrorCauseNameLv2.value) }}
                  </mat-select-trigger>
                  <mat-option *ngIf="lstTicketErrorCauseLv2.length > 0">
                    <ngx-mat-select-search noEntriesFoundLabel="{{'ticketExpire.search.noItemError' | translate}}"
                                           formControlName="ticketErrorCauseLv2Filter"
                                           placeholderLabel="{{'ticketExpire.search.placehoderExpireLv2' | translate}}"
                                           [showToggleAllCheckbox]="true" [toggleAllCheckboxChecked]="searchNNC2All"
                                           (toggleAll)="selectAllTicketErrorCauseLv2($event)">
                    </ngx-mat-select-search>
                  </mat-option>
                  <mat-option *ngFor="let item of filteredTicketErrorCauseLv2 | async" [value]="item"
                              (click)="onChangeTicketErrorCauseLv2()">
                    {{ item.label }}
                  </mat-option>
                </mat-select>
                <button *ngIf="formSearch.controls.ticketErrorCauseNameLv2.value" matSuffix mat-icon-button
                        type="button" class="btn-clear-drop"
                        (click)="formSearch.controls.ticketErrorCauseNameLv2.setValue(null); $event.stopPropagation(); clearTicketErrorCause2();clearCheckAll2()">
                  <mat-icon>close</mat-icon>
                </button>
              </mat-form-field>
            </div>

            <!--Nguyên nhân lỗi cấp 3-->
            <div fxFlex="33.33" fxFlex.lt-sm="100">
              <mat-form-field appearance="outline">
                <mat-label>{{ 'ticket-error-cause.ticketErrorCauseNameLv3' | translate }}
                </mat-label>
                <mat-select formControlName="ticketErrorCauseNameLv3" multiple>
                  <mat-select-trigger>
                    {{ getLabelInList(formSearch.controls.ticketErrorCauseNameLv3.value) }}
                  </mat-select-trigger>
                  <mat-option *ngIf="lstTicketErrorCauseLv3.length > 0">
                    <ngx-mat-select-search noEntriesFoundLabel="{{'ticketExpire.search.noItemError' | translate}}"
                                           formControlName="ticketErrorCauseLv3Filter"
                                           placeholderLabel="{{'ticketExpire.search.placehoderExpireLv3' | translate}}"
                                           [showToggleAllCheckbox]="true" [toggleAllCheckboxChecked]="searchNNC3All"
                                           (toggleAll)="selectAllTicketErrorCauseLv3($event)">
                    </ngx-mat-select-search>
                  </mat-option>
                  <mat-option *ngFor="let item of filteredTicketErrorCauseLv3 | async" [value]="item"
                              (click)="onChangeTicketErrorCauseLv3()">
                    {{ item.label }}
                  </mat-option>
                </mat-select>
                <button *ngIf="formSearch.controls.ticketErrorCauseNameLv3.value" matSuffix mat-icon-button
                        type="button" class="btn-clear-drop"
                        (click)="formSearch.controls.ticketErrorCauseNameLv3.setValue(null); $event.stopPropagation();">
                  <mat-icon>close</mat-icon>
                </button>
              </mat-form-field>
            </div>
          </div>

          <div fxLayout="row wrap" fxLayoutGap="20px grid">

            <!-- Ngày tạo -->
            <div fxFlex="33.33" fxFlex.lt-sm="100">
              <mat-form-field appearance="outline">
                <mat-label>{{'special-vehicle.createDateFrom'| translate}}</mat-label>
                <mat-date-range-input [rangePicker]="createDatePicker" (click)="createDatePicker.open()"
                                      [comparisonStart]="formSearch.value.formDate"
                                      [comparisonEnd]="formSearch.value.toDate">
                  <input matStartDate maskDate placeholder="dd/mm/yyyy" formControlName="formDate" #formDateId>
                  <input matEndDate maskDate placeholder="dd/mm/yyyy" formControlName="toDate" #toDateId>
                </mat-date-range-input>
                <mat-datepicker-toggle matSuffix *ngIf="formDateId.value || toDateId.value" class="showclearDatePopup"
                                       (click)="formSearch.controls.formDate.setValue(null);formSearch.controls.toDate.setValue(null); $event.stopPropagation()">
                  <mat-icon matDatepickerToggleIcon>close</mat-icon>
                </mat-datepicker-toggle>
                <mat-datepicker-toggle matSuffix [for]="createDatePicker"></mat-datepicker-toggle>
                <mat-date-range-picker #createDatePicker></mat-date-range-picker>
                <mat-error *ngIf="formSearch.controls.formDate.hasError('matStartDateInvalid')">
                  {{ 'customer.err_ResgiterFromDate' | translate }}
                </mat-error>
              </mat-form-field>
            </div>

          </div>

          <!-- Form action -->
          <div class="container" fxLayout fxLayout.xs="column" fxLayoutAlign="flex-end" fxLayoutGap="10px"
               fxLayoutGap.xs="0" style="margin-right: 8px;">

            <!-- Export File -->
            <button mat-raised-button color="primary" type="submit" (click)="onExportFile()">
              {{ 'ticketProcessConfig.button.Export' | translate }}
            </button>

            <!-- Import File -->
            <!--            <button mat-raised-button color='primary' type='submit' (click)='onImportFile()'>-->
            <!--              {{ 'ticketProcessConfig.button.Import' | translate }}-->
            <!--            </button>-->

            <!-- Thêm mới -->
            <button mat-raised-button color="primary" type="submit" (click)="onClickCreateMap()">
              {{ 'common.button.insert' | translate }}
            </button>

            <!-- Tìm kiếm -->
            <button mat-raised-button color="primary" type="submit" (click)="onSearch()">
              {{ 'common.button.search' | translate }}
            </button>

          </div>

        </form>
      </mat-expansion-panel>
    </mat-accordion>

    <!-- Danh sách map nguyên nhân lỗi -->
    <mat-card>
      <crm-table [headerTable]="'map-cause-error.title'" [columns]="columns" [isLoading]="isLoading" [showHeader]="true"
                 [isPaging]="true" [dataSource]="lstDataTicketErrorCause" (onPage)="onPageChange($event)"
                 [displayedColumns]="displayedColumnsTypeError" [pageIndex]="pageIndex"
                 [totalRecord]="countTableTicketErrorCause" [stickyHeight]="getHeightTable(lstDataTicketErrorCause)"
                 [widthTable]="'2200px'">
        <ng-container *ngFor="let item of columns" [ngSwitch]="item.field">

          <ng-container matColumnDef="{{ item.field }}" *ngSwitchDefault>
            <th mat-header-cell *matHeaderCellDef>{{ item.i18n | translate }}</th>
            <td mat-cell *matCellDef="let row">
              {{ row[item.field] }}
            </td>
          </ng-container>

          <!-- STT -->
          <ng-container matColumnDef="{{ item.field }}" *ngSwitchCase="'orderNumber'">
            <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">{{ item.i18n | translate }}</th>
            <td mat-cell *matCellDef="let row; let i = dataIndex" class="ui-text-center">
              {{ i + 1 + (formSearch.value.startRecord * formSearch.value.pageSize)}}
            </td>
          </ng-container>

          <!-- Checkbox Select -->
<!--          <ng-container matColumnDef="{{ item.field }}" *ngSwitchCase="'select'">-->
<!--            <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }"-->
<!--                style="text-align: center !important;">-->
<!--              <mat-checkbox [(ngModel)]="checkAll" (change)="onCheckAll($event)"></mat-checkbox>-->
<!--            </th>-->
<!--            <td mat-cell *matCellDef="let row" class="ui-text-center">-->
<!--              <mat-checkbox [(ngModel)]="row.checked" (change)="onCheckItem($event)"></mat-checkbox>-->
<!--            </td>-->
<!--          </ng-container>-->

          <!--Action-->
          <ng-container matColumnDef="action" *ngSwitchCase="'action'">
            <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
              {{'cateConfig.ticketType.action' | translate}}</th>
            <td mat-cell *matCellDef="let row; let i = index" class="ui-text-center" style="padding-right: 0px;">
              <button mat-icon-button>
                <mat-icon svgIcon="ic_edit" (click)="doUpdate(row)"
                          matTooltip="{{'map-cause-error.button-update-map' | translate}}">
                </mat-icon>
              </button>
<!--              <button mat-icon-button>-->
<!--                <mat-icon color="warn" (click)="doDelete(row)"-->
<!--                          matTooltip="{{'map-cause-error.button-delete-map' | translate}}">-->
<!--                  delete-->
<!--                </mat-icon>-->
<!--              </button>-->
            </td>
          </ng-container>

          <!--Nhóm phản ánh-->
          <ng-container matColumnDef="ticketGroup" *ngSwitchCase="'ticketGroup'">
            <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
              {{'ticketProcessConfig.table.ticketGroup' | translate}}
            </th>
            <td mat-cell *matCellDef="let row; let i = index">
              <span [innerHtml]="customViewName(row.ticketGroup)" matTooltip="{{row.ticketGroup}}"></span>
            </td>
          </ng-container>

          <!--Thể loại phản ánh-->
          <ng-container matColumnDef="ticketGenre" *ngSwitchCase="'ticketGenre'">
            <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
              {{'ticketProcessConfig.table.ticketGenre' | translate}}
            </th>
            <td mat-cell *matCellDef="let row; let i = index">
              <span [innerHtml]="customViewName(row.ticketGenre)" matTooltip="{{row.ticketGenre}}"></span>
            </td>
          </ng-container>

          <!--Nguyên nhân lỗi cấp 1-->
          <ng-container matColumnDef="ticketErrorName1" *ngSwitchCase="'ticketErrorName1'">
            <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
              {{'ticket-error-cause.ticketErrorCauseNameLv1' | translate}}
            </th>
            <td mat-cell *matCellDef="let row; let i = index">
              <span [innerHtml]="customViewName(row.ticketErrorName1)" matTooltip="{{row.ticketErrorName1}}"></span>
            </td>
          </ng-container>

          <!--Nguyên nhân lỗi cấp 2-->
          <ng-container matColumnDef="ticketErrorName2" *ngSwitchCase="'ticketErrorName2'">
            <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
              {{'ticket-error-cause.ticketErrorCauseNameLv2' | translate}}
            </th>
            <td mat-cell *matCellDef="let row; let i = index">
              <span [innerHtml]="customViewName(row.ticketErrorName2)" matTooltip="{{row.ticketErrorName2}}"></span>
            </td>
          </ng-container>

          <!--Nguyên nhân lỗi cấp 3-->
          <ng-container matColumnDef="ticketErrorName3" *ngSwitchCase="'ticketErrorName3'">
            <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
              {{'ticket-error-cause.ticketErrorCauseNameLv3' | translate}}
            </th>
            <td mat-cell *matCellDef="let row; let i = index">
              <span [innerHtml]="customViewName(row.ticketErrorName3)" matTooltip="{{row.ticketErrorName3}}"></span>
            </td>
          </ng-container>

          <!--Ngày tạo -->
          <ng-container matColumnDef="createDate" *ngSwitchCase="'createDate'">
            <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
              {{'cateConfig.ticketType.createDate' | translate}}
            </th>
            <td mat-cell *matCellDef="let row; let i = index">
              {{row.createDate}}
            </td>
          </ng-container>

          <!-- Người tạo -->
          <ng-container matColumnDef="createUser" *ngSwitchCase="'createUser'">
            <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
              {{'cateConfig.ticketType.createUser' | translate}}
            </th>
            <td mat-cell *matCellDef="let row; let i = index">
              {{row.createUser}}
            </td>
          </ng-container>

          <!-- Người cập nhật cuối-->
          <ng-container matColumnDef="updateUser" *ngSwitchCase="'updateUser'">
            <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
              {{'ticketExpire.table.lastUpdater' | translate}} </th>
            <td mat-cell *matCellDef="let row; let i = index">
              {{row.updateUser}}
            </td>
          </ng-container>

          <!-- Ngày cập nhật cuối-->
          <ng-container matColumnDef="updateDate" *ngSwitchCase="'updateDate'">
            <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
              {{'ticketExpire.table.updateLastTime' | translate}}
            </th>
            <td mat-cell *matCellDef="let row; let i = index">
              {{row.updateDate}}
            </td>
          </ng-container>

        </ng-container>
      </crm-table>
    </mat-card>
  </div>
</div>
