<div>
  <page-header></page-header>
  <div fxLayout="row wrap" class="  mt-15">
    <div fxFlex="100" fxFlex.lt-sm="100">
      <mat-accordion>
        <mat-expansion-panel [expanded]="true">
          <mat-expansion-panel-header>
            <mat-panel-title>
              ĐIỀU KIỆN TÌM KIẾM
            </mat-panel-title>
          </mat-expansion-panel-header>
          <form [formGroup]="formSearch" class="form-field-full">
            <div fxLayout="row wrap" fxLayoutGap="20px grid">
              <div fxFlex="33.33" fxFlex.lt-sm="100">
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'ticketExpire.search.ExpireLv1' | translate }}
                  </mat-label>
                  <mat-select formControlName="expireLevelOne" multiple>
                    <mat-select-trigger>
                      {{ getLabelInList(formSearch.controls.expireLevelOne.value) }}
                    </mat-select-trigger>
                    <mat-option *ngIf="lstExpireLvOne.length > 0">
                      <ngx-mat-select-search noEntriesFoundLabel="{{'ticketExpire.search.noItem' | translate}}"
                        formControlName="expireLevelOneFilter"
                        placeholderLabel="{{'ticketExpire.search.placehoderExpiredLv1' | translate}}"
                        [showToggleAllCheckbox]="true" [toggleAllCheckboxChecked]="searchEp1All"
                        (toggleAll)="selectAll($event)">
                      </ngx-mat-select-search>
                    </mat-option>
                    <mat-option *ngFor="let item of filteredExpireLevelOne | async" [value]="item"
                      (click)="onChangeExpireLvOne()">
                      {{ item.label }}
                    </mat-option>
                  </mat-select>
                  <button *ngIf="formSearch.controls.expireLevelOne.value" matSuffix mat-icon-button type="button"
                    class="btn-clear-drop"
                    (click)="formSearch.controls.expireLevelOne.setValue(null); $event.stopPropagation();clearTicketExpired1();clearCheckAll1();">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </div>
              <div fxFlex="33.33" fxFlex.lt-sm="100">
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'ticketExpire.search.ExpireLv2' | translate }}
                  </mat-label>
                  <mat-select formControlName="expireLevelTwo" multiple>
                    <mat-select-trigger>
                      {{ getLabelInList(formSearch.controls.expireLevelTwo.value) }}
                    </mat-select-trigger>
                    <mat-option *ngIf="lstExpireLvTwo.length > 0">
                      <ngx-mat-select-search noEntriesFoundLabel="{{'ticketExpire.search.noItem' | translate}}"
                        formControlName="expireLevelTwoFilter"
                        placeholderLabel="{{'ticketExpire.search.placehoderExpiredLv2' | translate}}"
                        [showToggleAllCheckbox]="true" [toggleAllCheckboxChecked]="searchEp2All"
                        (toggleAll)="selectAllExpireTwo($event)">
                      </ngx-mat-select-search>
                    </mat-option>
                    <mat-option *ngFor="let item of filteredExpireLevelTwo | async" [value]="item"
                      (click)="onChangeExpireLvTwo()">
                      {{ item.label }}
                    </mat-option>
                  </mat-select>
                  <button *ngIf="formSearch.controls.expireLevelTwo.value" matSuffix mat-icon-button type="button"
                    class="btn-clear-drop"
                    (click)="formSearch.controls.expireLevelTwo.setValue(null); $event.stopPropagation();clearTicketExpired2();clearCheckAll2()">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </div>
              <div fxFlex="33.33" fxFlex.lt-sm="100">
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'ticketExpire.search.ExpireLv3' | translate }}
                  </mat-label>
                  <mat-select formControlName="expireLevelThree" multiple>
                    <mat-select-trigger>
                      {{ getLabelInList(formSearch.controls.expireLevelThree.value) }}
                    </mat-select-trigger>
                    <mat-option *ngIf="lstExpireLvThree.length > 0">
                      <ngx-mat-select-search noEntriesFoundLabel="{{'ticketExpire.search.noItem' | translate}}"
                        formControlName="expireLevelThreeFilter"
                        placeholderLabel="{{'ticketExpire.search.placehoderExpiredLv3' | translate}}"
                        [showToggleAllCheckbox]="true" [toggleAllCheckboxChecked]="searchEp3All"
                        (toggleAll)="selectAllExpireThree($event)">
                      </ngx-mat-select-search>

                    </mat-option>
                    <mat-option *ngFor="let item of filteredExpireLevelThree | async" [value]="item"
                      (click)="onChangeExpireLvThree()">
                      <!-- (click)='onChangeExpireLvThree()'> -->
                      {{ item.label }}
                    </mat-option>
                  </mat-select>
                  <button *ngIf="formSearch.controls.expireLevelThree.value" matSuffix mat-icon-button type="button"
                    class="btn-clear-drop"
                    (click)="formSearch.controls.expireLevelThree.setValue(null); $event.stopPropagation();">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </div>
            </div>
            <div fxLayout="row wrap" fxLayoutGap="20px grid">
              <!-- nguoi tao-->
              <div fxFlex="33.33" fxFlex.lt-sm="100">
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'ticketExpire.search.createUser' | translate }}
                  </mat-label>
                  <input trim="blur" matInput placeholder="{{'cateConfig.ticketType.ticketTypeCode' |
                                        translate}}" autocomplete="off" formControlName="createUser" />
                  <button matSuffix mat-icon-button type="button" class="btn-clear-drop"
                    *ngIf="formSearch.controls.createUser.value"
                    (click)="formSearch.controls.createUser.setValue(null); $event.stopPropagation();">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </div>
              <!-- Trạng thái -->
              <div fxFlex="33.33" fxFlex.lt-sm="100">
                <!--                <mat-form-field appearance="outline" floatLabel="always">-->
                <!--                  <mat-label>{{'cateConfig.ticketType.status' | translate}}</mat-label>-->
                <!--                  <input matInput style="height: 0px;" />-->
                <!--                  <div fxLayout="row wrap" fxLayoutGap="4px grid" class="radio-stl" style="height: 10px;">-->
                <!--                    <mat-checkbox formControlName="inEffect" class="checkbox">Đang hiệu lực</mat-checkbox>-->
                <!--                    <mat-checkbox formControlName="expire" class="checkbox  ml-70" style="margin-left: 20px">Không hiệu-->
                <!--                      lực-->
                <!--                    </mat-checkbox>-->
                <!--                  </div>-->
                <!--                </mat-form-field>-->
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'common.status' | translate }}
                  </mat-label>
                  <mat-select formControlName="status" multiple>
                    <mat-select-trigger>
                      {{ getLabelInList(formSearch.controls.status.value) }}
                    </mat-select-trigger>
                    <mat-option #allStatus *ngIf="statuses.length > 0" (click)="onChangeStatusAll()" [value]="-1">
                      {{ 'common.all' | translate }}
                    </mat-option>
                    <mat-option *ngFor="let item of statuses" [value]="item" (click)="onChangeStatusOne()">
                      {{ item.label }}
                    </mat-option>
                  </mat-select>
                  <button matSuffix mat-icon-button type="button" class="btn-clear-drop"
                    *ngIf="formSearch.controls.status.value"
                    (click)="formSearch.controls.status.setValue(null); $event.stopPropagation();">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </div>
              <!-- Ngay tao-->
              <div fxFlex="33.33" fxFlex.lt-sm="100">
                <mat-form-field appearance="outline">
                  <mat-label>{{ 'ticketExpire.search.createDate' | translate }}
                  </mat-label>
                  <mat-date-range-input [rangePicker]="receiveTimePicker" (click)="receiveTimePicker.open()">
                    <input matStartDate formControlName="formDate" #formDate maskDate
                      placeholder="{{ 'common.fromDate' | translate }}">
                    <input matEndDate formControlName="toDate" maskDate placeholder="{{ 'common.endDate' | translate }}"
                      #toDate>
                  </mat-date-range-input>
                  <mat-datepicker-toggle matSuffix *ngIf="formDate.value || toDate.value" class="showclearDatePopup"
                    (click)="formSearch.controls.formDate.setValue(null);
                                      formSearch.controls.toDate.setValue(null); $event.stopPropagation()">
                    <mat-icon matDatepickerToggleIcon>close</mat-icon>
                  </mat-datepicker-toggle>
                  <mat-datepicker-toggle matSuffix [for]="receiveTimePicker"></mat-datepicker-toggle>
                  <mat-date-range-picker #receiveTimePicker></mat-date-range-picker>
                </mat-form-field>
              </div>
            </div>
            <div fxLayout='row wrap' fxLayoutGap='20px grid'>
              <div fxFlex='33.33' fxFlex.lt-sm='100'>
                <mat-form-field appearance='outline'>
                  <mat-label>{{ 'ticketExpire.search.levelExpire' | translate }}
                  </mat-label>
                  <mat-select formControlName='levelExpire' multiple>
                    <mat-select-trigger>
                      {{ getLabelInList(formSearch.controls.levelExpire.value) }}
                    </mat-select-trigger>
                    <mat-option #levelExpire *ngIf='lstLevelExpire.length > 0' (click)='onChangeLevelExpireAll()'
                                [value]='-1'>
                      {{ 'common.all' | translate }}
                    </mat-option>
                    <mat-option *ngFor='let item of lstLevelExpire' [value]='item' (click)='onChangeLevelExpire()'>
                      {{ item.label }}
                    </mat-option>
                  </mat-select>
                  <button matSuffix mat-icon-button type='button' class='btn-clear-drop'
                          *ngIf='formSearch.controls.levelExpire.value'
                          (click)='formSearch.controls.levelExpire.setValue(null); $event.stopPropagation();'>
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </div>
            </div>
            <div fxLayout="row wrap" fxLayoutGap="20px grid">
              <div fxFlex="100" fxFlex.lt-sm="100">
                <button type="submit" class="float-right ml-20" mat-button mat-raised-button color="primary"
                  (click)="doSearch()">{{
                  'ticketExpire.search.searchButton' | translate }}
                </button>
                <button type="submit" class="float-right ml-20" mat-button mat-raised-button color="primary"
                  (click)="onOpenDialog()">{{ 'ticketExpire.search.addNew' | translate }}
                </button>
                <button type="submit" class="float-right" mat-button mat-raised-button color="primary"
                  (click)="onChangeStatusMultiple()">{{'cateConfig.change_status' | translate}}
                </button>
              </div>
            </div>
          </form>
        </mat-expansion-panel>
      </mat-accordion>
    </div>
  </div>
</div>

<div fxLayout="row wrap" class="mt-15">
  <div fxFlex="100" fxFlex.lt-sm="100">
    <mat-accordion>
      <div class="form-field-full">
        <mat-card appearance="outline">
          <crm-table [headerTable]="'ticketExpire.table.ExpireTitle'" [isLoading]="isLoading" [isPaging]="true"
            [dataSource]="listDataExpireCause" (onPage)="onPageChange($event)" [totalRecord]="countTableExpireCause"
            [displayedColumns]="displayedColumnsType" [pageIndex]="pageIndex" [widthTable]="'2200px'"
            [stickyHeader]="true" [stickyHeight]="getHeightTable(countTableExpireCause)">
            <ng-container *ngFor="let item of columns" [ngSwitch]="item.field">
              <ng-container matColumnDef="{{ item.field }}" *ngSwitchDefault>
                <th mat-header-cell *matHeaderCellDef>{{ item.i18n | translate }}</th>
                <td mat-cell *matCellDef="let row">
                  {{ row[item.field] }}
                </td>
              </ng-container>
              <ng-container matColumnDef="{{ item.field }}" *ngSwitchCase="'orderNumber'">
                <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">{{ item.i18n | translate }}</th>
                <td mat-cell *matCellDef="let row; let i = dataIndex" class="ui-text-center">
                  {{ i + 1 + (formSearch.value.startRecord * formSearch.value.pageSize)}}
                </td>
              </ng-container>
              <ng-container matColumnDef="{{ item.field }}" *ngSwitchCase="'select'">
                <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }"
                  style="text-align: center !important;">
                  <mat-checkbox [(ngModel)]="checkAll" (change)="onCheckAll($event)"></mat-checkbox>
                </th>
                <td mat-cell *matCellDef="let row" class="ui-text-center">
                  <mat-checkbox [(ngModel)]="row.checked" (change)="onCheckItem($event)"></mat-checkbox>
                </td>
              </ng-container>
              <ng-container matColumnDef="action" *ngSwitchCase="'action'">
                <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
                  {{'cateConfig.ticketType.action' | translate}}</th>
                <td mat-cell *matCellDef="let row; let i = index" class="ui-text-center" style="padding-right: 0px;">
                  <!--                  <button mat-icon-button>-->
                  <!--                    <mat-icon svgIcon='ic_edit' (click)='doUpdate(row)'-->
                  <!--                      matTooltip="{{'cateConfig.ticketType.actionEditExpire' | translate}}">-->
                  <!--                    </mat-icon>-->
                  <!--                  </button>-->
                  <!--                  <button mat-icon-button>-->
                  <!--                    <mat-icon color='warn' (click)='doDelete(row)'-->
                  <!--                      matTooltip="{{'cateConfig.ticketType.actionDeleteExpire' | translate}}">-->
                  <!--                      delete-->
                  <!--                    </mat-icon>-->
                  <!--                  </button>-->
                  <button mat-icon-button>
                    <mat-icon class="toggle_on toggle-size" color="warn" *ngIf="row.status === 0"
                      matTooltip="{{'cateConfig.ticket-genre.table.icon.changestatus' | translate}}"
                      (click)="doChangeStatus(row)">
                      toggle_off
                    </mat-icon>
                    <mat-icon class="toggle-off-color toggle-size" *ngIf="row.status === 1"
                      matTooltip="{{'cateConfig.ticket-genre.table.icon.changestatus' | translate}}"
                      (click)="doChangeStatus(row)">
                      toggle_on
                    </mat-icon>
                  </button>
                </td>
              </ng-container>
              <ng-container matColumnDef="expireLv1" *ngSwitchCase="'expireLv1'">
                <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
                  {{'ticketExpire.table.ExpiraCause' | translate}}
                </th>
                <td mat-cell *matCellDef="let row; let i = index">
                  <span [innerHtml]="customViewDescription(row.expireCauseNameParent)"
                    matTooltip="{{row.expireCauseNameParent}}"></span>
                </td>
              </ng-container>
              <ng-container matColumnDef="levelExpire" *ngSwitchCase="'levelExpire'">
                <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
                  {{'ticketExpire.table.levelExpire' | translate}}
                </th>
                <td mat-cell *matCellDef="let row; let i = index"> {{row.levelExpire}} </td>
              </ng-container>
              <ng-container matColumnDef="expireCode" *ngSwitchCase="'expireCode'">
                <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
                  {{'ticketExpire.table.ExpireCode' | translate}}
                </th>
                <td mat-cell *matCellDef="let row; let i = index"> {{row.expireCauseCode}} </td>
              </ng-container>
              <ng-container matColumnDef="expireName" *ngSwitchCase="'expireName'">
                <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
                  {{'ticketExpire.table.ExpireName' | translate}}
                </th>
                <td mat-cell *matCellDef="let row; let i = index">
                  <span [innerHtml]="customViewName(row.expireCauseName)" matTooltip="{{row.expireCauseName}}"></span>
                </td>
              </ng-container>
              <ng-container matColumnDef="createUser" *ngSwitchCase="'createUser'">
                <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
                  {{'ticketExpire.table.createUser' | translate}}
                </th>
                <td mat-cell *matCellDef="let row; let i = index">
                  {{row.createUser}}
                </td>
              </ng-container>
              <ng-container matColumnDef="createDate" *ngSwitchCase="'createDate'">
                <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
                  {{'ticketExpire.table.createDate' | translate}}
                </th>
                <td mat-cell *matCellDef="let row; let i = index">
                  {{row.createDate}}
                </td>
              </ng-container>
              <ng-container matColumnDef="updateUser" *ngSwitchCase="'updateUser'">
                <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
                  {{'ticketExpire.table.lastUpdater' | translate}}
                </th>
                <td mat-cell *matCellDef="let row; let i = index">
                  {{row.updateUser}}
                </td>
              </ng-container>
              <ng-container matColumnDef="updateDate" *ngSwitchCase="'updateDate'">
                <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
                  {{'ticketExpire.table.updateLastTime' | translate}}
                </th>
                <td mat-cell *matCellDef="let row; let i = index">
                  {{row.updateDate}}
                </td>
              </ng-container>
              <!--Mô tả-->
              <ng-container matColumnDef="description" *ngSwitchCase="'description'">
                <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
                  {{'ticketReflectiveStatistics.table.description' | translate}}
                </th>
                <td mat-cell *matCellDef="let row; let i = index">
                  <span [innerHtml]="customViewDescription(row.description)" matTooltip="{{row.description}}"></span>
                </td>
              </ng-container>
              <ng-container matColumnDef="status" *ngSwitchCase="'status'">
                <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: item.width }">
                  {{'ticketExpire.table.status' | translate}}
                </th>
                <td mat-cell *matCellDef="let row; let i = index">
                  <div *ngIf="row.status === 1">
                    {{'ticketExpire.inEffect' | translate}}
                  </div>
                  <div *ngIf="row.status === 0">
                    {{'ticketExpire.expire' | translate}}
                  </div>
                </td>
              </ng-container>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumnsType"></tr>
            <tr mat-row
              *matRowDef="let row;
                columns: ['orderNumber','select','action','expireLv1','expireLv2','expireLv3','createUser','createDate','updateUser','updateLastTime','status']">
            </tr>
            <!-- <tr mat-row *matRowDef='let row; columns: displayedColumns;'></tr> -->
            <span class="noRecored" *ngIf="!dataSource || dataSource?.data?.length === 0 ">
              {{'common.noRecord' | translate}}
            </span>
          </crm-table>
        </mat-card>
      </div>
    </mat-accordion>
  </div>
</div>
