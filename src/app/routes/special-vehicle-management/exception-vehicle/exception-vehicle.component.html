<div *ngIf="hasPermission(permissionApp.CC_VEHICLE_02)">
  <page-header></page-header>
  <div fxLayout="row wrap" class="  mt-15">
    <div fxFlex="100" fxFlex.lt-sm="100" class=" ">
      <mat-accordion>
        <mat-expansion-panel [expanded]="true">
          <mat-expansion-panel-header>
            <mat-panel-title>
              {{ 'common.title' | translate | uppercase }}
            </mat-panel-title>
          </mat-expansion-panel-header>
          <form [formGroup]="formSearch" class="form-field-full">
            <div fxLayout="row wrap" fxLayoutGap="20px grid">
              <div fxFlex="33.33" fxFlex.lt-sm="100">
                <mat-form-field appearance="outline">
                  <mat-label>{{'special-vehicle.exceptionType' | translate}}</mat-label>
                  <mat-select formControlName="exceptionType">
                    <mat-option>{{ 'common.default-select' | translate }}</mat-option>
                    <ng-container *ngFor="let item of listOptionExceptionType">
                      <mat-option [value]="item.code">{{item.value}}</mat-option>
                    </ng-container>
                  </mat-select>
                  <button *ngIf="formSearch.controls.exceptionType.value" matSuffix mat-icon-button type="button"
                    class="btn-clear-drop"
                    (click)="formSearch.controls.exceptionType.setValue(null); $event.stopPropagation();">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </div>
              <div fxFlex="33.33" fxFlex.lt-sm="100">
                <mat-form-field appearance="outline">
                  <mat-label>{{'special-vehicle.groupVehicle' | translate}}</mat-label>
                  <mat-select formControlName="groupVehicle">
                    <mat-option>{{ 'common.default-select' |translate }}</mat-option>
                    <ng-container *ngFor="let item of listOptionGroupVehicles">
                      <mat-option [value]="item.id">{{item.value}}</mat-option>
                    </ng-container>
                  </mat-select>
                  <button *ngIf="formSearch.controls.groupVehicle.value" matSuffix mat-icon-button type="button"
                    class="btn-clear-drop"
                    (click)="formSearch.controls.groupVehicle.setValue(null); $event.stopPropagation();">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </div>
              <div fxFlex="33.33" fxFlex.lt-sm="100">
                <mat-form-field appearance="outline">
                  <mat-label>{{'special-vehicle.plateNumber' | translate}}</mat-label>
                  <input matInput
                    placeholder="{{ 'customer-management.newVehicleForm.placeholder-hint-platenumber' | translate }}"
                    formControlName="plateNumber" autocomplete="off" />
                  <button mat-button *ngIf="formSearch.controls.plateNumber.value" matSuffix mat-icon-button
                    aria-label="Clear" type="button"
                    (click)="formSearch.controls.plateNumber.setValue(null); $event.stopPropagation()"
                    class="showclear">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </div>
            </div>
            <div fxLayout="row wrap" fxLayoutGap="20px grid">
              <div fxFlex="33.33" fxFlex.lt-sm="100">
                <mat-form-field appearance="outline">
                  <mat-label>{{'special-vehicle.plateType' | translate}}</mat-label>
                  <mat-select formControlName="plateType">
                    <ng-container *ngFor="let item of  listOptionPlateTypes">
                      <mat-option [value]="item.code">{{item.value}}</mat-option>
                    </ng-container>
                  </mat-select>
                  <button *ngIf="formSearch.controls.plateType.value" matSuffix mat-icon-button type="button"
                    class="btn-clear-drop"
                    (click)="formSearch.controls.plateType.setValue(null); $event.stopPropagation();">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </div>
              <div fxFlex="33.33" fxFlex.lt-sm="100">
                <mat-form-field appearance="outline">
                  <mat-label>{{'special-vehicle.epc' | translate}}</mat-label>
                  <input matInput placeholder="{{'special-vehicle.epc'  | translate}}" formControlName="epc"
                    autocomplete="off" />
                  <button mat-button type="button" *ngIf="formSearch.controls.epc.value" matSuffix mat-icon-button
                    aria-label="Clear" (click)="formSearch.controls.epc.setValue(null); $event.stopPropagation()"
                    class="showclear">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </div>
              <div fxFlex="33.33" fxFlex.lt-sm="100">
                <mat-form-field appearance="outline">
                  <mat-label>{{'special-vehicle.stationOrStage' | translate}}</mat-label>
                  <mat-select formControlName="stationOrStage" [multiple]="true">
                    <mat-option>
                      <ngx-mat-select-search noEntriesFoundLabel="{{'special-vehicle.notItem' |translate}}"
                        formControlName="stationOrStageFilter"
                        placeholderLabel="{{'special-vehicle.placehoderStation' | translate}}"
                        [showToggleAllCheckbox]="true" (toggleAll)="selectAll($event)">
                      </ngx-mat-select-search>
                    </mat-option>
                    <ng-container *ngFor="let item of filteredStageOrStation | async">
                      <mat-option [value]="item">{{item.name}}</mat-option>
                    </ng-container>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
            <div fxLayout="row wrap" fxLayoutGap="20px grid">
              <div fxFlex="33.33" fxFlex.lt-sm="100">
                <mat-form-field appearance="outline">
                  <mat-label>{{'special-vehicle.status' |
                    translate}}</mat-label>
                  <mat-select formControlName="status">
                    <mat-option>{{ 'common.default-select' |
                      translate }}</mat-option>
                    <ng-container *ngFor="let item of
                                        listOptionStatus">
                      <mat-option [value]="item.code">{{item.value}}</mat-option>
                    </ng-container>
                  </mat-select>
                  <button *ngIf="formSearch.controls.status.value" matSuffix mat-icon-button type="button"
                    class="btn-clear-drop"
                    (click)="formSearch.controls.status.setValue(null); $event.stopPropagation();">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </div>
              <div fxFlex="33.33" fxFlex.lt-sm="100">
                <mat-form-field class="example-form-field" appearance="outline">
                  <mat-label>{{'special-vehicle.createDateFrom'| translate}}</mat-label>
                  <mat-date-range-input [rangePicker]="createDatePicker" (click)="createDatePicker.open()"
                    [comparisonStart]="formSearch.value.createDateFrom" [comparisonEnd]="formSearch.value.createDateTo">
                    <input matStartDate maskDate placeholder="dd/mm/yyyy" formControlName="createDateFrom"
                      #createDateFromId>
                    <input matEndDate maskDate placeholder="dd/mm/yyyy" formControlName="createDateTo" #createDateToId>
                  </mat-date-range-input>
                  <mat-datepicker-toggle matSuffix *ngIf="createDateFromId.value || createDateToId.value"
                    class="showclearDatePopup"
                    (click)="formSearch.controls.createDateFrom.setValue(null);formSearch.controls.createDateTo.setValue(null); $event.stopPropagation()">
                    <mat-icon matDatepickerToggleIcon>close</mat-icon>
                  </mat-datepicker-toggle>
                  <mat-datepicker-toggle matSuffix [for]="createDatePicker"></mat-datepicker-toggle>
                  <mat-date-range-picker #createDatePicker></mat-date-range-picker>
                  <mat-error *ngIf="formSearch.controls.createDateFrom.hasError('matStartDateInvalid')">
                    {{ 'customer.err_ResgiterFromDate' | translate }}
                  </mat-error>
                </mat-form-field>
              </div>
              <div fxFlex="33.33" fxFlex.lt-sm="100">
                <mat-form-field class="example-form-field" appearance="outline">
                  <mat-label>{{'special-vehicle.approvalDateFrom'| translate}}</mat-label>
                  <mat-date-range-input [rangePicker]="approveDatePicker" (click)="approveDatePicker.open()"
                    [comparisonStart]="formSearch.value.approvalDateFrom"
                    [comparisonEnd]="formSearch.value.approvalDateTo">
                    <input matStartDate maskDate placeholder="dd/mm/yyyy" formControlName="approvalDateFrom"
                      #approvalDateFromId>
                    <input matEndDate maskDate placeholder="dd/mm/yyyy" formControlName="approvalDateTo"
                      #approvalDateToId>
                  </mat-date-range-input>
                  <mat-datepicker-toggle matSuffix *ngIf="approvalDateFromId.value || approvalDateToId.value"
                    class="showclearDatePopup"
                    (click)="formSearch.controls.approvalDateFrom.setValue(null);formSearch.controls.approvalDateTo.setValue(null); $event.stopPropagation()">
                    <mat-icon matDatepickerToggleIcon>close</mat-icon>
                  </mat-datepicker-toggle>
                  <mat-datepicker-toggle matSuffix [for]="approveDatePicker"></mat-datepicker-toggle>
                  <mat-date-range-picker #approveDatePicker></mat-date-range-picker>
                  <mat-error *ngIf="formSearch.controls.approvalDateFrom.hasError('matStartDateInvalid')">
                    {{ 'customer.err_ResgiterFromDate' | translate }}
                  </mat-error>
                </mat-form-field>
              </div>
            </div>
            <div fxLayout="row wrap" fxLayoutGap="20px grid">
              <div fxFlex="33.33" fxFlex.lt-sm="100">
                <mat-form-field class="example-form-field" appearance="outline">
                  <mat-label>{{'special-vehicle.effectiveDateFrom'| translate}}</mat-label>
                  <mat-date-range-input [rangePicker]="effectiveDatePicker" (click)="effectiveDatePicker.open()"
                    [comparisonStart]="formSearch.value.effectiveDateFrom"
                    [comparisonEnd]="formSearch.value.effectiveDateTo">
                    <input matStartDate maskDate placeholder="dd/mm/yyyy" formControlName="effectiveDateFrom"
                      #effectiveDateFromId>
                    <input matEndDate maskDate placeholder="dd/mm/yyyy" formControlName="effectiveDateTo"
                      #effectiveDateToId>
                  </mat-date-range-input>
                  <mat-datepicker-toggle matSuffix *ngIf="effectiveDateFromId.value || effectiveDateToId.value"
                    class="showclearDatePopup"
                    (click)="formSearch.controls.effectiveDateFrom.setValue(null);formSearch.controls.effectiveDateTo.setValue(null); $event.stopPropagation()">
                    <mat-icon matDatepickerToggleIcon>close</mat-icon>
                  </mat-datepicker-toggle>
                  <mat-datepicker-toggle matSuffix [for]="effectiveDatePicker"></mat-datepicker-toggle>
                  <mat-date-range-picker #effectiveDatePicker></mat-date-range-picker>
                  <mat-error *ngIf="formSearch.controls.effectiveDateFrom.hasError('matStartDateInvalid')">
                    {{ 'customer.err_ResgiterFromDate' | translate }}
                  </mat-error>
                </mat-form-field>
              </div>
              <div fxFlex="33.33" fxFlex.lt-sm="100">
                <mat-form-field appearance="outline" floatLabel="always">
                  <mat-label>{{'promotion.status.effect'
                    | translate}}</mat-label>
                  <input matInput style="height: 0px;" />
                  <div fxLayout="row wrap" fxLayoutGap="4px grid" class="radio-stl" style="height: 10px;">
                    <mat-checkbox formControlName="inEffect" class="checkbox">{{
                      'special-vehicle.inEffect' | translate }}</mat-checkbox>
                    <mat-checkbox formControlName="expire" class="checkbox  ml-70">{{
                      'special-vehicle.expire' | translate }}</mat-checkbox>
                  </div>
                </mat-form-field>
              </div>
            </div>
            <div fxLayout="row wrap" fxLayoutGap="20px grid">
              <div fxFlex="100" fxFlex.lt-sm="100" class="mt-25">
                <button type="submit" class="float-right ml-20" mat-button (click)="onSearch()" mat-raised-button
                  color="primary">{{'briefcase.search' |
                  translate}}</button>
              </div>
            </div>
          </form>
        </mat-expansion-panel>
      </mat-accordion>
    </div>
  </div>

  <div fxLayout="row wrap" class="  mt-15">
    <div fxFlex="100" fxFlex.lt-sm="100" class=" ">
      <mat-accordion>
        <div class="form-field-full">
          <mat-card appearance="outline">
            <div class="container" fxLayout fxLayout.xs="column" fxLayoutAlign="flex-end" fxLayoutGap="10px"
              fxLayoutGap.xs="0" style="margin-right: 8px !important;">
              <button mat-button class="float-right ml-20" mat-raised-button (click)="onClickInsertVehicle()"
                color="primary">{{'common.button.insert' | translate}}</button>
            </div>
            <crm-table [headerTable]="'special-vehicle.title-page-exception'" [dataSource]="listDataVehicles"
              [totalRecord]="countTableVehicles" [isLoading]="isLoading" [isPaging]="true" [showHeader]="true"
              [displayedColumns]="displayedColumnsVehicles" [pageIndex]="pageIndex" (onPage)="onPageChange($event)">
              <ng-container *ngFor="let item of columns" [ngSwitch]="item.field">
                <ng-container matColumnDef="{{ item.field }}" *ngSwitchDefault>
                  <th mat-header-cell *matHeaderCellDef>{{ item.i18n | translate }}</th>
                  <td mat-cell *matCellDef="let row">
                    {{ row[item.field] }}
                  </td>
                </ng-container>
                <ng-container matColumnDef="{{ item.field }}" *ngSwitchCase="'select'">
                  <th mat-header-cell *matHeaderCellDef style="text-align: center !important;">
                    <mat-checkbox (change)="$event ? masterToggle() : null"
                      [checked]="selection.hasValue() && isAllSelected()"
                      [indeterminate]="selection.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()">
                    </mat-checkbox>
                  </th>
                  <td mat-cell *matCellDef="let row" class="ui-text-center">
                    <mat-checkbox [disabled]="((row?.status != statusVehicleSpecial.CREATE_NEW) && (row?.status == statusVehicleSpecial.APPROVED && row?.isEdit != 1))
                    || (row?.status == statusVehicleSpecial.REJECT)" (click)="$event.stopPropagation()"
                      (change)="$event ? checkChange(row) : null" [checked]="selection.isSelected(row)"
                      [aria-label]="checkboxLabel(row)">
                    </mat-checkbox>
                  </td>
                </ng-container>
                <ng-container matColumnDef="{{ item.field }}" *ngSwitchCase="'orderNumber'">
                  <th mat-header-cell *matHeaderCellDef>{{ item.i18n | translate }}</th>
                  <td mat-cell *matCellDef="let row; let i = dataIndex" class="ui-text-center">
                    {{ i + 1 + formSearch.value.startrecord }}
                  </td>
                </ng-container>
                <ng-container matColumnDef="exceptionType" *ngSwitchCase="'exceptionType'">
                  <th mat-header-cell *matHeaderCellDef>
                    {{'special-vehicle.exceptionType' |
                    translate}}</th>
                  <td mat-cell *matCellDef="let row; let i=
                                  index">
                    <span *ngIf="row.exceptionType ==specialPriority.VEHICLE">{{'special-vehicle.vehicle.type'
                      |translate}}</span>
                    <span
                      *ngIf="row.exceptionType ==specialPriority.TICKET">{{'special-vehicle.ticket.type'|translate}}</span>
                  </td>
                </ng-container>
                <ng-container matColumnDef="vehicleTypeId" *ngSwitchCase="'vehicleTypeId'">
                  <th mat-header-cell *matHeaderCellDef>
                    {{'vehicle.groupTypeVehicleFee' |
                    translate}}</th>
                  <td mat-cell *matCellDef="let row; let i=
                                  index">
                    <span *ngIf="row.vehicleTypeId ==1">{{'vehicle-group.1'
                      |translate}}</span>
                    <span *ngIf="row.vehicleTypeId ==2">{{'vehicle-group.2'
                      |translate}}</span>
                    <span *ngIf="row.vehicleTypeId ==3">{{'vehicle-group.3'
                      |translate}}</span>
                    <span *ngIf="row.vehicleTypeId ==4">{{'vehicle-group.4'
                      |translate}}</span>
                    <span *ngIf="row.vehicleTypeId ==5">{{'vehicle-group.5'
                      |translate}}</span>
                    <span *ngIf="row.vehicleTypeId ==11">{{'vehicle-group.11'
                      |translate}}</span>
                    <span *ngIf="row.vehicleTypeId ==12">{{'vehicle-group.12'
                      |translate}}</span>
                    <span *ngIf="row.vehicleTypeId ==31">{{'vehicle-group.31'
                      |translate}}</span>
                    <span *ngIf="row.vehicleTypeId ==32">{{'vehicle-group.32'
                      |translate}}</span>
                  </td>
                </ng-container>
                <ng-container matColumnDef="status" *ngSwitchCase="'status'">
                  <th mat-header-cell *matHeaderCellDef>
                    {{'special-vehicle.status' | translate}}</th>
                  <td mat-cell *matCellDef="let row; let i = index">
                    <p *ngIf="row.status == statusVehicleSpecial.PENDING" style="color:purple">
                      {{'pricelist.wait' |translate}}</p>
                    <p *ngIf="row.status == statusVehicleSpecial.APPROVED && row.isEdit !=1" style="color:green">
                      {{'manage-fee.status.approved' |translate}}</p>
                    <p *ngIf="row.status == statusVehicleSpecial.APPROVED && row.isEdit == 1"
                      style="color:rgb(255, 174, 0)">
                      {{'special-vehicle.change_effect' |translate}}</p>
                    <p *ngIf="row.status == statusVehicleSpecial.CREATE_NEW" style="color:blue">
                      {{'promotion.status.new' | translate}}</p>
                    <p *ngIf="row.status == statusVehicleSpecial.CANCELLED_EXPIRE" style="color:red">
                      {{'pricelist.invalidate' |translate}}
                    </p>
                    <p *ngIf="row.status == statusVehicleSpecial.REJECT" style="color:black">
                      {{'pricelist.reject' |translate}}
                    </p>
                  </td>
                </ng-container>
                <ng-container matColumnDef="effectiveDate" *ngSwitchCase="'effectiveDate'">
                  <th mat-header-cell *matHeaderCellDef>
                    {{'special-vehicle.effectiveDate' |
                    translate}}</th>
                  <td mat-cell *matCellDef="let row; let i=
                                    index">
                    {{row.effDate}}
                    <span *ngIf="row.expDate"> - </span>
                    {{row.expDate}}
                  </td>
                </ng-container>
                <ng-container matColumnDef="action" *ngSwitchCase="'action'">
                  <th mat-header-cell *matHeaderCellDef>
                    {{'special-vehicle.action' | translate}}</th>
                  <td mat-cell *matCellDef="let row; let i= index" class="ui-text-center" style="padding-right:
                                    0px;">
                    <button mat-icon-button>
                      <mat-icon svgIcon="ic_xem" (click)="onClickViewVehicle(row)" matTooltip="{{'special-vehicle.actionView'
                                            | translate}}">
                      </mat-icon>
                    </button>
                    <!-- 12/7/2020: Dung tester -->
                    <!-- <button mat-icon-button>
                    <mat-icon svgIcon="ic_download" (click)="onDownloadVehicle(row)" matTooltip="{{'special-vehicle.actionDownload'
                                            | translate}}">
                    </mat-icon>
                  </button> -->
                    <button mat-icon-button
                      *ngIf="row?.status == statusVehicleSpecial.CREATE_NEW || row?.status == statusVehicleSpecial.APPROVED">
                      <mat-icon svgIcon="ic_edit" (click)="onClickUpdateVehicle(row)" matTooltip="{{'special-vehicle.edit-exception'
                                            | translate}}">
                      </mat-icon>
                    </button>
                    <button mat-icon-button
                      *ngIf="row?.status == statusVehicleSpecial.CREATE_NEW || row?.status == statusVehicleSpecial.REJECT"
                      (click)="onClickDeleteVehicle(row)">
                      <mat-icon color="warn" matTooltip="{{'special-vehicle.delete-exception'
                                            | translate}}">
                        delete
                      </mat-icon>
                    </button>
                  </td>
                </ng-container>
              </ng-container>
            </crm-table>
            <div class="row mt-25">
              <div class="col-sm-12">
                <button class="btnRight ml-20" mat-button mat-raised-button (click)="onClickExportVehicle()"
                  color="primary">{{'common.exportExcel' |
                  translate}}</button>
                <button class="btnRight ml-20" mat-button mat-raised-button [disabled]="selection.selected.length == 0"
                  (click)="onClickApproveVehicle()" color="primary">{{'briefcase.approve' |
                  translate}}</button>
                <button class="btnRight ml-20" mat-button mat-raised-button [disabled]="selection.selected.length == 0"
                  (click)="onClickDenyVehicle()" color="primary">{{'special-vehicle.deny' | translate}}</button>
              </div>
            </div>
          </mat-card>
        </div>
      </mat-accordion>
    </div>
  </div>
</div>
<div *ngIf="!hasPermission(permissionApp.CC_VEHICLE_02)">
  <error-code code="403" [title]="'common.invalid-permission-title'" [message]="'common.invalid-permission'">
  </error-code>
</div>
